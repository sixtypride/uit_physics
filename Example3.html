<!DOCTYPE html>
<html>
<head>
    <title>Example</title>

    <style>
        body {
            background: #dddddd;
        }

        #canvas {
            background: #ffffff;
            border: thin inset #aaaaaa;
        }
    </style>
</head>

<body>
<canvas id='canvas' width="800" height="600">
    Canvas not supported
</canvas>
<script src="common.js"></script>
<script>
    var canvas = document.getElementById("canvas");
    var context = canvas.getContext("2d");

    var line = new Line(new Point(100, 100), new Point(400, 200));
    var line1 = new Line(new Point(100, 700), new Point(400, 100));

    var ball = new Ball(context);

    render();

    canvas.onmousemove = function (e) {
        var loc = windowToCanvas(e.clientX, e.clientY);

        ball.x = loc.x;
        ball.y = loc.y;

        //hitTestByDistance();
        hitTestByIntersect();

        render();
    }

    function hitTestByDistance() {
        var a = new Vector2d(line.ePt.x - line.sPt.x, line.ePt.y - line.sPt.y);
        var b = new Vector2d(line.sPt.x - ball.x, line.sPt.y - ball.y);

        var t = (b.dot(a) / a.dot(a)) * -1;

        if(t < 0 || t > 1) return;

        var p = a.scale(t).add(b);

        if(p.length() <= ball.radius){
            ball.color = "red";
        } else {
            ball.color = "black";
        }
    }

    function hitTestByIntersect() {
        var a = new Vector2d(line.ePt.x - line.sPt.x, line.ePt.y - line.sPt.y);
        var i = new Vector2d(line1.ePt.x - line1.sPt.x, line1.ePt.y - line1.sPt.y);
        var b = new Vector2d(line.sPt.x - line1.sPt.x, line.sPt.y - line1.sPt.y);

        var t = b.dot(i.normal()) / a.dot(i.normal()) * -1;
        var s = b.dot(a.normal()) / i.dot(a.normal());

        if(t < 0 || t > 1 || s < 0 || s > 1) return;

        var p = a.scale(t).add(b);

        ball.x = line1.sPt.x + p.vx;
        ball.y = line1.sPt.y + p.vy;
    }

    function render() {
        context.clearRect(0,0,canvas.width, canvas.height);

        line.draw();
        line1.draw();
        ball.draw();
    }

</script>
</body>
</html>

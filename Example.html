<!DOCTYPE html>
<html>
<head>
    <title>Example</title>

    <style>
        body {
            background: #dddddd;
        }

        #canvas {
            background: #ffffff;
            border: thin inset #aaaaaa;
        }
    </style>
</head>

<body>
<canvas id='canvas' width="800" height="600">
    Canvas not supported
</canvas>
<script>
    var canvas = document.getElementById("canvas");
    var context = canvas.getContext("2d");

    // Util
    function windowToCanvas(x, y) {
        var bbox = canvas.getBoundingClientRect();
        return { x : x - bbox.left, y : y - bbox.top }
    }

    // Ball
    function Ball() {
        this.radius = 10;
        this.x = 0;
        this.y = 0;
        this.vx = 0;
        this.vy = 0;
    }

    Ball.prototype = {
        draw : function () {
            context.save();

            context.beginPath();
            context.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            context.fill();

            context.restore();
        }
    };

    // Vector2d
    function Vector2d(vx, vy) {
        this.vx = vx;
        this.vy = vy;
    }

    Vector2d.prototype = {
        add : function (vec) {
            return new Vector2d(this.vx + vec.vx, this.vy + vec.vy);
        },
        sub : function (vec) {
            return new Vector2d(this.vx - vec.vx, this.vy - vec.vy);
        },
        dot : function (vec) {
            return this.vx * vec.vx + this.vy * vec.vy;
        },
        scale : function (scale) {
            return new Vector2d(this.vx * scale, this.vy * scale);
        },
        length : function () {
            return Math.sqrt(this.vx * this.vx + this.vy * this.vy);
        },
        normalize : function () {
            var len = this.length();
            return new Vector2d(this.vx / len, this.vy / len);
        }
    };

    // Main
    var startX = 100;
    var startY = 100;

    var speed = 10;
    var gravity = 0.2;

    var friction = 1;

    var ball = new Ball();

    ball.x = startX;
    ball.y = startY;

    canvas.onmousedown = function(e) {
        var loc = windowToCanvas(e.clientX, e.clientY);

        shootBall(loc);
    }

    function shootBall(loc) {
        var dx = loc.x - startX;
        var dy = loc.y - startY;

        var a = new Vector2d(dx, dy);
        var b = a.normalize().scale(speed);

        ball.vx = b.vx;
        ball.vy = b.vy;

        ball.x = startX;
        ball.y = startY;
    }

    requestAnimationFrame(loop);

    // animation tick
    function loop() {

        //ball.vy += gravity;

        ball.x += ball.vx;
        ball.y += ball.vy;

        if(ball.x < ball.radius) {
            ball.x = ball.radius;
            ball.vx *= -friction;
        }
        else if(ball.x > canvas.width - ball.radius) {
            ball.x = canvas.width - ball.radius;
            ball.vx *= -friction;
        }
        else if(ball.y < ball.radius) {
            ball.y = ball.radius;
            ball.vy *= -friction;
        }
        else if(ball.y > canvas.height - ball.radius) {
            ball.y = canvas.height - ball.radius;
            ball.vy *= -friction;
        }

        render();
        requestAnimationFrame(loop);
    }
    function render() {
        context.clearRect(0, 0, canvas.width, canvas.height)

        ball.draw();
    }

</script>
</body>
</html>
